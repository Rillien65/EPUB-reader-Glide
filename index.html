<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>eReader</title>
  <script src="https://cdn.jsdelivr.net/npm/epubjs@0.3.88/dist/epub.min.js"></script>
  <style>
    body, html {
      margin: 0; padding: 0; height: 100%; font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      background-color: #fff; color: #111;
      display: flex; flex-direction: column;
    }

    #toolbar {
      padding: 10px;
      background: #f3f3f3;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    #reader {
      flex-grow: 1;
      height: 100%;
      width: 100%;
      overflow: hidden;
    }

    button, input[type="range"] {
      font-size: 16px;
      padding: 5px 10px;
    }

    .dark-mode {
      background-color: #111;
      color: #eee;
    }

    .dark-mode #toolbar {
      background-color: #222;
    }

    .dark-mode iframe {
      background-color: #111 !important;
    }
  </style>
</head>
<body>
  <div id="toolbar">
    <label>Font Size:
      <input type="range" id="fontSize" min="12" max="36" value="16">
    </label>
    <button id="darkToggle">ðŸŒ™ Toggle Dark</button>
  </div>

  <div id="reader"></div>

  <script>
    // âœ… Replace this with any public EPUB URL that has CORS enabled
    const epubUrl = "https://s3.amazonaws.com/moby-dick/moby-dick.epub";

    const book = ePub(epubUrl);
    const rendition = book.renderTo("reader", {
      width: "100%",
      height: "100%",
      flow: "paginated", // Makes it feel like iBooks with swipe page turns
      manager: "continuous" // Try "default" for fixed pages
    });

    rendition.display();

    // Font size control
    const fontSizeSlider = document.getElementById("fontSize");
    fontSizeSlider.addEventListener("input", (e) => {
      rendition.themes.fontSize(e.target.value + "px");
    });

    // Dark mode
    const toggleBtn = document.getElementById("darkToggle");
    let dark = false;
    toggleBtn.addEventListener("click", () => {
      dark = !dark;
      document.body.classList.toggle("dark-mode", dark);
      rendition.themes.register("dark", {
        body: {
          background: "#111",
          color: "#eee"
        },
        "::selection": {
          background: "#444"
        }
      });
      rendition.themes.select(dark ? "dark" : null);
    });

    // Swipe navigation
    document.addEventListener("keydown", (e) => {
      if (e.key === "ArrowRight") rendition.next();
      if (e.key === "ArrowLeft") rendition.prev();
    });

    let touchStartX = 0;
    document.getElementById("reader").addEventListener("touchstart", (e) => {
      touchStartX = e.changedTouches[0].screenX;
    });

    document.getElementById("reader").addEventListener("touchend", (e) => {
      const dx = e.changedTouches[0].screenX - touchStartX;
      if (dx > 50) rendition.prev();
      if (dx < -50) rendition.next();
    });
  </script>
</body>
</html>
